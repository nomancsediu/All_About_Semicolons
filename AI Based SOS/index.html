<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeGuard - Women's Safety App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 40px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        @keyframes flash-red {
            0%, 100% { background-color: rgb(239, 68, 68); }
            50% { background-color: rgb(220, 38, 38); }
        }
        
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse-ring {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        .sos-active {
            animation: pulse-red 1s infinite, flash-red 0.5s infinite;
        }
        
        .call-ring {
            animation: pulse-ring 1.5s infinite;
        }
        
        .slide-up {
            animation: slideIn 0.3s ease-out;
        }
        
        .slide-down {
            animation: slideDown 0.3s ease-out;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .emergency-card {
            transition: all 0.3s ease;
        }
        
        .emergency-card:hover {
            transform: translateY(-5px);
        }

        /* Location tracking animation */
        @keyframes location-pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .location-pulse::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.5);
            transform: translate(-50%, -50%);
            animation: location-pulse 2s infinite;
        }

        /* AI Assistant Styles */
        .ai-message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .ai-response {
            background-color: #f1f5f9;
            border-bottom-left-radius: 4px;
            align-self: flex-start;
            text-align: left;
        }
        
        .user-message {
            background-color: #6366f1;
            color: white;
            border-bottom-right-radius: 4px;
            align-self: flex-end;
            text-align: right;
        }
        
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            background-color: #f1f5f9;
            padding: 12px 16px;
            border-radius: 18px;
            border-bottom-left-radius: 4px;
            margin-bottom: 12px;
            align-self: flex-start;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #64748b;
            margin: 0 2px;
            animation: typing-animation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing-animation {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sos-button {
                width: 180px !important;
                height: 180px !important;
            }
            
            .fake-call-button {
                width: 90% !important;
            }
            
            .emergency-service-card {
                margin-bottom: 1rem;
            }
            
            .ai-message {
                max-width: 90%;
            }
        }

        @media (max-width: 480px) {
            .sos-button {
                width: 150px !important;
                height: 150px !important;
            }
            
            .app-title {
                font-size: 1.2rem !important;
            }
            
            .nav-text {
                display: none;
            }
            
            .mobile-nav-icon {
                font-size: 1.2rem !important;
                margin-right: 0 !important;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            
            .footer-links {
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen flex flex-col">
    <!-- Navigation Bar -->
    <nav class="bg-gradient-to-r from-purple-700 to-pink-600 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-3">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-shield-alt text-2xl"></i>
                    <h1 class="text-xl font-bold app-title">SafeGuard</h1>
                </div>
                
                <!-- Hamburger Menu Button (Mobile) -->
                <button id="hamburgerBtn" class="md:hidden focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
                
                <!-- Desktop Navigation -->
                <div id="desktopNav" class="hidden md:flex items-center space-x-2">
                    <button id="homeBtn" class="nav-btn px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-sm">
                        <i class="fas fa-home mr-1"></i> <span class="nav-text">Home</span>
                    </button>
                    <button id="contactsBtn" class="nav-btn px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-sm">
                        <i class="fas fa-address-book mr-1"></i> <span class="nav-text">Contacts</span>
                    </button>
                    <button id="emergencyBtn" class="nav-btn px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-sm">
                        <i class="fas fa-ambulance mr-1"></i> <span class="nav-text">Emergency</span>
                    </button>
                    <button id="aiAssistantBtn" class="nav-btn px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-sm">
                        <i class="fas fa-robot mr-1"></i> <span class="nav-text">AI Assistant</span>
                    </button>
                    <!-- Cancel SOS Button (Hidden by default) -->
                    <button id="cancelSosNavBtn" class="hidden px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 transition font-bold text-sm">
                        <i class="fas fa-times-circle mr-1"></i> <span class="nav-text">Cancel SOS</span>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobileNav" class="hidden pb-3 slide-up">
                <div class="grid grid-cols-1 gap-2">
                    <button id="homeBtnMobile" class="nav-btn-mobile px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-left text-sm">
                        <i class="fas fa-home mobile-nav-icon mr-2"></i> Home
                    </button>
                    <button id="contactsBtnMobile" class="nav-btn-mobile px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-left text-sm">
                        <i class="fas fa-address-book mobile-nav-icon mr-2"></i> Contacts
                    </button>
                    <button id="emergencyBtnMobile" class="nav-btn-mobile px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-left text-sm">
                        <i class="fas fa-ambulance mobile-nav-icon mr-2"></i> Emergency
                    </button>
                    <button id="aiAssistantBtnMobile" class="nav-btn-mobile px-3 py-2 rounded-lg hover:bg-white hover:bg-opacity-20 transition text-left text-sm">
                        <i class="fas fa-robot mobile-nav-icon mr-2"></i> AI Assistant
                    </button>
                    <!-- Cancel SOS Button (Hidden by default) -->
                    <button id="cancelSosNavBtnMobile" class="hidden px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 transition font-bold text-left text-sm">
                        <i class="fas fa-times-circle mobile-nav-icon mr-2"></i> Cancel SOS
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- SOS Active Banner -->
    <div id="sosBanner" class="hidden bg-red-600 text-white p-3 text-center font-bold shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between">
            <div class="flex items-center mb-2 md:mb-0">
                <i class="fas fa-exclamation-triangle mr-2 text-xl"></i>
                <span>SOS ALERT ACTIVE - Location sharing enabled</span>
            </div>
            <div class="flex items-center">
                <i class="fas fa-clock mr-2"></i>
                <span id="sosTimer">00:00</span>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <main class="flex-grow">
        <div class="container mx-auto px-4 py-6">
            <!-- Home Screen -->
            <div id="mainScreen" class="screen">
                <!-- SOS Button at the Very Top -->
                <div class="mb-8">
                    <div class="bg-white rounded-2xl shadow-xl p-6 border-2 border-red-200">
                        <div class="text-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-800 mb-1">EMERGENCY SOS</h2>
                            <p class="text-gray-600 text-sm">Tap below for immediate help - Location will be shared automatically</p>
                        </div>
                        <div class="flex justify-center">
                            <button id="sosButton" class="sos-button w-52 h-52 rounded-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white text-2xl font-bold shadow-2xl transition-all transform hover:scale-105 focus:outline-none">
                                <i class="fas fa-exclamation-triangle text-5xl mb-3"></i>
                                <div>SOS</div>
                                <div class="text-base font-normal mt-1">TAP NOW</div>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Fake Call Button -->
                <div class="mb-8">
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <div class="text-center mb-4">
                            <h3 class="text-xl font-bold text-gray-800 mb-1">Fake Call</h3>
                            <p class="text-gray-600 text-sm">Simulate an incoming call to escape uncomfortable situations</p>
                        </div>
                        <div class="flex justify-center">
                            <button id="fakeCallButton" class="fake-call-button w-48 h-14 rounded-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-lg font-bold shadow-lg transition-all transform hover:scale-105 focus:outline-none">
                                <i class="fas fa-phone-alt mr-2"></i> Fake Call
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contacts Screen -->
            <div id="contactsScreen" class="screen hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Emergency Contacts</h2>
                        
                        <!-- Add Contact Form -->
                        <div class="bg-gray-50 p-6 rounded-xl mb-6">
                            <h3 class="text-lg font-semibold mb-4">Add New Contact</h3>
                            <form id="addContactForm" class="space-y-4">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="contactName" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                        <input type="text" id="contactName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    </div>
                                    <div>
                                        <label for="contactPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                        <input type="tel" id="contactPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium py-3 px-4 rounded-lg transition">
                                    <i class="fas fa-plus-circle mr-2"></i> Add Contact
                                </button>
                            </form>
                        </div>
                        
                        <!-- Contacts List -->
                        <div class="bg-gray-50 rounded-xl overflow-hidden">
                            <h3 class="text-lg font-semibold p-4 bg-white border-b">Your Emergency Contacts</h3>
                            <div id="contactsList" class="divide-y divide-gray-200">
                                <!-- Contacts will be dynamically added here -->
                                <div class="p-4 text-center text-gray-500">
                                    No contacts added yet. Add emergency contacts above.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Emergency Services Screen -->
            <div id="emergencyScreen" class="screen hidden">
                <!-- Content will be dynamically loaded here -->
            </div>

            <!-- AI Assistant Screen -->
            <div id="aiAssistantScreen" class="screen hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <i class="fas fa-robot text-purple-600 mr-2"></i> AI Safety Assistant
                        </h2>
                        
                        <div class="mb-6 p-4 bg-purple-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-lightbulb text-purple-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-800">Get personalized safety advice</p>
                                    <p class="text-sm text-gray-600">Describe your situation for context-aware recommendations</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Chat Container -->
                        <div class="bg-gray-50 rounded-xl p-4 mb-6 h-96 overflow-y-auto flex flex-col" id="aiChatContainer">
                            <div class="ai-message ai-response">
                                <p>Hello! I'm your AI safety assistant. How can I help you stay safe today? You can describe your situation or ask for safety advice.</p>
                            </div>
                            <!-- Messages will be added here dynamically -->
                        </div>
                        
                        <!-- Quick Action Buttons -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
                            <button class="quick-action-btn bg-purple-100 hover:bg-purple-200 text-purple-800 py-2 px-3 rounded-lg text-sm transition" data-prompt="I'm walking alone at night">
                                <i class="fas fa-moon mr-1"></i> Walking at night
                            </button>
                            <button class="quick-action-btn bg-purple-100 hover:bg-purple-200 text-purple-800 py-2 px-3 rounded-lg text-sm transition" data-prompt="I'm in a taxi alone">
                                <i class="fas fa-taxi mr-1"></i> In a taxi
                            </button>
                            <button class="quick-action-btn bg-purple-100 hover:bg-purple-200 text-purple-800 py-2 px-3 rounded-lg text-sm transition" data-prompt="I'm feeling followed">
                                <i class="fas fa-exclamation-triangle mr-1"></i> Feeling followed
                            </button>
                            <button class="quick-action-btn bg-purple-100 hover:bg-purple-200 text-purple-800 py-2 px-3 rounded-lg text-sm transition" data-prompt="What are general safety tips">
                                <i class="fas fa-tips mr-1"></i> Safety tips
                            </button>
                        </div>
                        
                        <!-- Input Area -->
                        <div class="flex space-x-2">
                            <input type="text" id="aiInput" placeholder="Describe your situation or ask for advice..." class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <button id="sendAiMessage" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-medium py-3 px-6 rounded-lg transition">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

<!-- Footer -->
<footer class="bg-gray-900 text-white mt-auto">
  <!-- Gradient line -->
  <div class="h-0.5 w-full bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600"></div>
  
  <!-- Footer content -->
  <div class="container mx-auto px-4 py-4 text-center">
    <p class="text-gray-400 text-xs md:text-sm tracking-wide">
      © 2025 All About Semicolons. Built with ❤️ and Dedication.
    </p>
  </div>
</footer>


    <!-- Cancel SOS Modal -->
    <div id="cancelSosModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl w-11/12 md:w-96 max-w-full p-6 mx-4">
            <h3 class="text-xl font-bold mb-4">Cancel SOS Alert</h3>
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check-circle text-green-600 text-3xl"></i>
                </div>
                <p class="text-gray-600">Are you sure you want to cancel the SOS alert?</p>
                <p class="text-sm text-gray-500 mt-2">An "I'm safe" message will be sent to your emergency contacts.</p>
            </div>
            <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
                <button onclick="cancelSOS()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition">
                    Yes, I'm Safe
                </button>
                <button onclick="closeCancelModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-medium py-2 px-4 rounded-lg transition">
                    Continue SOS
                </button>
            </div>
        </div>
    </div>

    <!-- Fake Call Modal -->
    <div id="fakeCallModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="w-full max-w-md mx-4">
            <!-- Incoming Call Screen -->
            <div id="incomingCallScreen" class="bg-gray-900 rounded-3xl overflow-hidden shadow-2xl text-white">
                <div class="p-8 text-center">
                    <div class="mb-6">
                        <div class="w-32 h-32 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6 call-ring">
                            <i class="fas fa-user text-5xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold mb-2" id="callerName">Mom</h2>
                        <p class="text-gray-300 text-lg" id="callerPhone">+1 (555) 123-4567</p>
                    </div>
                    
                    <div class="mb-8">
                        <p class="text-gray-400">Incoming call...</p>
                    </div>
                    
                    <div class="flex justify-center space-x-8">
                        <button id="declineCallBtn" class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center hover:bg-red-700 transition transform hover:scale-110">
                            <i class="fas fa-phone-slash text-2xl"></i>
                        </button>
                        <button id="acceptCallBtn" class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center hover:bg-green-700 transition transform hover:scale-110">
                            <i class="fas fa-phone text-2xl"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Active Call Screen -->
            <div id="activeCallScreen" class="bg-gray-900 rounded-3xl overflow-hidden shadow-2xl text-white hidden">
                <div class="p-8 text-center">
                    <div class="mb-6">
                        <div class="w-32 h-32 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-user text-5xl"></i>
                        </div>
                        <h2 class="text-3xl font-bold mb-2" id="activeCallerName">Mom</h2>
                        <p class="text-gray-300 text-lg" id="activeCallerPhone">+1 (555) 123-4567</p>
                    </div>
                    
                    <div class="mb-8">
                        <p class="text-gray-400">00:00</p>
                    </div>
                    
                    <div class="flex justify-center">
                        <button id="endCallBtn" class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center hover:bg-red-700 transition transform hover:scale-110">
                            <i class="fas fa-phone-slash text-2xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let sosActive = false;
        let sosStartTime;
        let sosInterval;
        let currentLocation = null;
        let locationTrackingInterval = null;
        let fakeCallActive = false;
        let callTimer = null;
        let callSeconds = 0;
        let ringingInterval = null;

        // DOM Elements
        const screens = {
            home: document.getElementById('mainScreen'),
            contacts: document.getElementById('contactsScreen'),
            emergency: document.getElementById('emergencyScreen'),
            aiAssistant: document.getElementById('aiAssistantScreen')
        };

        const navButtons = {
            home: document.getElementById('homeBtn'),
            contacts: document.getElementById('contactsBtn'),
            emergency: document.getElementById('emergencyBtn'),
            aiAssistant: document.getElementById('aiAssistantBtn')
        };

        const navButtonsMobile = {
            home: document.getElementById('homeBtnMobile'),
            contacts: document.getElementById('contactsBtnMobile'),
            emergency: document.getElementById('emergencyBtnMobile'),
            aiAssistant: document.getElementById('aiAssistantBtnMobile')
        };

        // Fake Call DOM Elements
        const fakeCallModal = document.getElementById('fakeCallModal');
        const incomingCallScreen = document.getElementById('incomingCallScreen');
        const activeCallScreen = document.getElementById('activeCallScreen');
        const acceptCallBtn = document.getElementById('acceptCallBtn');
        const declineCallBtn = document.getElementById('declineCallBtn');
        const endCallBtn = document.getElementById('endCallBtn');

        // AI Assistant Elements
        const aiChatContainer = document.getElementById('aiChatContainer');
        const aiInput = document.getElementById('aiInput');
        const sendAiMessageBtn = document.getElementById('sendAiMessage');
        const quickActionButtons = document.querySelectorAll('.quick-action-btn');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkLocationPermission();
            renderContacts();
            setupFakeCallEventListeners();
            setupAiAssistantEventListeners();
        });

        // Hamburger Menu Toggle
        document.getElementById('hamburgerBtn').addEventListener('click', () => {
            const mobileNav = document.getElementById('mobileNav');
            mobileNav.classList.toggle('hidden');
        });

        // Navigation
        Object.keys(navButtons).forEach(screen => {
            if (navButtons[screen]) {
                navButtons[screen].addEventListener('click', () => showScreen(screen));
            }
            if (navButtonsMobile[screen]) {
                navButtonsMobile[screen].addEventListener('click', () => {
                    showScreen(screen);
                    document.getElementById('mobileNav').classList.add('hidden');
                });
            }
        });

        function showScreen(screenName) {
            // Hide all screens
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            
            // Show selected screen
            screens[screenName].classList.remove('hidden');
            
            // Update active nav button
            document.querySelectorAll('.nav-btn, .nav-btn-mobile').forEach(btn => {
                btn.classList.remove('bg-white', 'bg-opacity-20');
            });
            
            if (navButtons[screenName]) {
                navButtons[screenName].classList.add('bg-white', 'bg-opacity-20');
            }
            if (navButtonsMobile[screenName]) {
                navButtonsMobile[screenName].classList.add('bg-white', 'bg-opacity-20');
            }
            
            // If Emergency screen, load nearby services
            if (screenName === 'emergency') {
                showNearbyEmergencyServices();
            }
        }

        // SOS Functionality
        document.getElementById('sosButton').addEventListener('click', () => {
            activateSOS();
        });

        document.getElementById('cancelSosNavBtn').addEventListener('click', () => {
            document.getElementById('cancelSosModal').classList.remove('hidden');
        });

        document.getElementById('cancelSosNavBtnMobile').addEventListener('click', () => {
            document.getElementById('cancelSosModal').classList.remove('hidden');
            document.getElementById('mobileNav').classList.add('hidden');
        });

        function activateSOS() {
            if (sosActive) return;
            
            sosActive = true;
            sosStartTime = Date.now();
            document.getElementById('sosButton').classList.add('sos-active');
            
            // Show cancel button in navbar
            document.getElementById('cancelSosNavBtn').classList.remove('hidden');
            document.getElementById('cancelSosNavBtnMobile').classList.remove('hidden');
            
            // Show SOS banner
            document.getElementById('sosBanner').classList.remove('hidden');
            
            // Vibrate if available
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200, 100, 200]);
            }
            
            // Start timer
            updateSOSTimer();
            sosInterval = setInterval(updateSOSTimer, 1000);
            
            // Automatically share location and start tracking
            shareLocationWithContacts();
            startLocationTracking();
        }

        function cancelSOS() {
            if (!sosActive) return;
            
            sosActive = false;
            document.getElementById('sosButton').classList.remove('sos-active');
            
            // Hide cancel button from navbar
            document.getElementById('cancelSosNavBtn').classList.add('hidden');
            document.getElementById('cancelSosNavBtnMobile').classList.add('hidden');
            
            // Hide SOS banner
            document.getElementById('sosBanner').classList.add('hidden');
            
            // Hide cancel modal
            document.getElementById('cancelSosModal').classList.add('hidden');
            
            // Stop timer
            clearInterval(sosInterval);
            
            // Stop location tracking
            stopLocationTracking();
            
            // Send "I'm safe" message to contacts
            sendSafetyMessage();
        }

        function closeCancelModal() {
            document.getElementById('cancelSosModal').classList.add('hidden');
        }

        function updateSOSTimer() {
            const elapsed = Math.floor((Date.now() - sosStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('sosTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Location Sharing and Tracking
        function shareLocationWithContacts() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                    },
                    error => {
                        console.error('Error getting location:', error);
                    }
                );
            }
        }

        function startLocationTracking() {
            // Start tracking location updates
            if (navigator.geolocation) {
                locationTrackingInterval = navigator.geolocation.watchPosition(
                    position => {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                    },
                    error => {
                        console.error('Location tracking error:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            }
        }

        function stopLocationTracking() {
            if (locationTrackingInterval) {
                navigator.geolocation.clearWatch(locationTrackingInterval);
                locationTrackingInterval = null;
            }
        }

        function sendSafetyMessage() {
            const contacts = getContacts();
            // In a real app, this would send SMS to all emergency contacts
            console.log(`"I'm safe" message sent to ${contacts.length} contacts`);
        }

        function checkLocationPermission() {
            if (navigator.permissions) {
                navigator.permissions.query({ name: 'geolocation' }).then(result => {
                    if (result.state === 'granted') {
                        getCurrentLocation();
                    }
                });
            }
        }

        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        currentLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        };
                    },
                    error => {
                        console.error('Error getting location:', error);
                    }
                );
            }
        }

        // Fake Call Functionality
        document.getElementById('fakeCallButton').addEventListener('click', () => {
            initiateFakeCall();
        });

        function setupFakeCallEventListeners() {
            acceptCallBtn.addEventListener('click', acceptFakeCall);
            declineCallBtn.addEventListener('click', declineFakeCall);
            endCallBtn.addEventListener('click', endFakeCall);
        }

        function initiateFakeCall() {
            if (fakeCallActive) return;
            
            fakeCallActive = true;
            
            // Get a random contact for the fake call
            const contacts = getContacts();
            let caller = { name: 'Mom', phone: '+1 (555) 123-4567' };
            
            if (contacts.length > 0) {
                const randomContact = contacts[Math.floor(Math.random() * contacts.length)];
                caller = {
                    name: randomContact.name,
                    phone: randomContact.phone
                };
            }
            
            // Set caller information
            document.getElementById('callerName').textContent = caller.name;
            document.getElementById('callerPhone').textContent = caller.phone;
            document.getElementById('activeCallerName').textContent = caller.name;
            document.getElementById('activeCallerPhone').textContent = caller.phone;
            
            // Show incoming call screen
            incomingCallScreen.classList.remove('hidden');
            activeCallScreen.classList.add('hidden');
            fakeCallModal.classList.remove('hidden');
            
            // Start ringing
            startRinging();
        }

        function startRinging() {
            // Simulate ringing sound (in a real app, you would play an actual ringing sound)
            let ringCount = 0;
            ringingInterval = setInterval(() => {
                ringCount++;
                // Auto-decline after 30 seconds
                if (ringCount >= 30) {
                    declineFakeCall();
                }
            }, 1000);
        }

        function stopRinging() {
            if (ringingInterval) {
                clearInterval(ringingInterval);
                ringingInterval = null;
            }
        }

        function acceptFakeCall() {
            stopRinging();
            
            // Switch to active call screen
            incomingCallScreen.classList.add('hidden');
            activeCallScreen.classList.remove('hidden');
            
            // Start call timer
            callSeconds = 0;
            updateCallTimer();
            callTimer = setInterval(updateCallTimer, 1000);
        }

        function declineFakeCall() {
            endFakeCall();
        }

        function endFakeCall() {
            fakeCallActive = false;
            stopRinging();
            
            // Stop call timer if active
            if (callTimer) {
                clearInterval(callTimer);
                callTimer = null;
            }
            
            // Hide the fake call modal
            fakeCallModal.classList.add('hidden');
        }

        function updateCallTimer() {
            callSeconds++;
            const minutes = Math.floor(callSeconds / 60);
            const seconds = callSeconds % 60;
            const timerElement = activeCallScreen.querySelector('.text-gray-400');
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Emergency Services
        function showNearbyEmergencyServices() {
            if (!navigator.geolocation) {
                console.error("Geolocation is not supported by this browser.");
                showDefaultEmergencyServices();
                return;
            }

            // Loading state
            const emergencyScreen = document.getElementById('emergencyScreen');
            emergencyScreen.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Nearby Emergency Services</h2>
                        <div class="text-center py-8">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-600"></div>
                            <p class="mt-4 text-gray-600">Finding nearby emergency services...</p>
                        </div>
                    </div>
                </div>
            `;

            // Get current location
            navigator.geolocation.getCurrentPosition(
                position => {
                    const { latitude, longitude } = position.coords;
                    fetchNearbyEmergencyServices(latitude, longitude);
                },
                error => {
                    console.error("Error getting location:", error);
                    showDefaultEmergencyServices();
                }
            );
        }

        function fetchNearbyEmergencyServices(lat, lng) {
            // In a real app, you would use Google Places API or similar
            // For demo purposes, we'll simulate with sample data
            setTimeout(() => {
                const demoServices = {
                    police: [
                        { name: "Central Police Station", address: "123 Main St", distance: 0.8, phone: "100" },
                        { name: "Downtown Police Station", address: "456 Park Ave", distance: 1.2, phone: "100" }
                    ],
                    hospital: [
                        { name: "City General Hospital", address: "789 Health Blvd", distance: 1.5, phone: "102" },
                        { name: "Emergency Medical Center", address: "321 Care Way", distance: 2.3, phone: "102" }
                    ],
                    fire_station: [
                        { name: "Main Fire Department", address: "555 Rescue Rd", distance: 1.0, phone: "101" },
                        { name: "Eastside Fire Station", address: "777 Safety Dr", distance: 1.8, phone: "101" }
                    ]
                };
                
                displayNearbyEmergencyServices(demoServices);
            }, 1500); // Simulate loading delay
        }

        function displayNearbyEmergencyServices(services) {
            const emergencyScreen = document.getElementById('emergencyScreen');
            
            let servicesHTML = `
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">Nearby Emergency Services</h2>
                            <button onclick="showNearbyEmergencyServices()" class="text-sm text-purple-600 hover:text-purple-800">
                                <i class="fas fa-sync-alt mr-1"></i> Refresh
                            </button>
                        </div>
                        
                        <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-location-arrow text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-800">Using your current location</p>
                                    <p class="text-sm text-gray-600">Showing services within 5km radius</p>
                                </div>
                            </div>
                        </div>
            `;
            
            // Police stations
            servicesHTML += `
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-shield-alt text-red-600 mr-2"></i> Police Stations
                    </h3>
                    <div class="space-y-4">
            `;
            
            services.police.forEach(station => {
                servicesHTML += `
                    <div class="bg-red-50 rounded-xl p-4 border border-red-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-gray-800">${station.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${station.address}</p>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-map-marker-alt text-red-500 mr-1"></i>
                                    <span class="text-gray-600">${station.distance} km away</span>
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <button onclick="callEmergency('police', '${station.phone}')" class="bg-red-600 hover:bg-red-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition">
                                    <i class="fas fa-phone-alt mr-1"></i> Call
                                </button>
                                <button onclick="getDirections('${station.name}', '${station.address}')" class="bg-white hover:bg-gray-100 text-gray-800 text-sm font-medium py-2 px-4 rounded-lg border border-gray-300 transition">
                                    <i class="fas fa-directions mr-1"></i> Directions
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            servicesHTML += `
                    </div>
                </div>
            `;
            
            // Hospitals
            servicesHTML += `
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-hospital text-blue-600 mr-2"></i> Hospitals
                    </h3>
                    <div class="space-y-4">
            `;
            
            services.hospital.forEach(hospital => {
                servicesHTML += `
                    <div class="bg-blue-50 rounded-xl p-4 border border-blue-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-gray-800">${hospital.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${hospital.address}</p>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-map-marker-alt text-blue-500 mr-1"></i>
                                    <span class="text-gray-600">${hospital.distance} km away</span>
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <button onclick="callEmergency('hospital', '${hospital.phone}')" class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition">
                                    <i class="fas fa-phone-alt mr-1"></i> Call
                                </button>
                                <button onclick="getDirections('${hospital.name}', '${hospital.address}')" class="bg-white hover:bg-gray-100 text-gray-800 text-sm font-medium py-2 px-4 rounded-lg border border-gray-300 transition">
                                    <i class="fas fa-directions mr-1"></i> Directions
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            servicesHTML += `
                    </div>
                </div>
            `;
            
            // Fire stations
            servicesHTML += `
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-fire-extinguisher text-orange-600 mr-2"></i> Fire Stations
                    </h3>
                    <div class="space-y-4">
            `;
            
            services.fire_station.forEach(station => {
                servicesHTML += `
                    <div class="bg-orange-50 rounded-xl p-4 border border-orange-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-gray-800">${station.name}</h4>
                                <p class="text-sm text-gray-600 mb-2">${station.address}</p>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-map-marker-alt text-orange-500 mr-1"></i>
                                    <span class="text-gray-600">${station.distance} km away</span>
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <button onclick="callEmergency('fire', '${station.phone}')" class="bg-orange-600 hover:bg-orange-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition">
                                    <i class="fas fa-phone-alt mr-1"></i> Call
                                </button>
                                <button onclick="getDirections('${station.name}', '${station.address}')" class="bg-white hover:bg-gray-100 text-gray-800 text-sm font-medium py-2 px-4 rounded-lg border border-gray-300 transition">
                                    <i class="fas fa-directions mr-1"></i> Directions
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            servicesHTML += `
                    </div>
                </div>
            `;
            
            // Women Helpline (not location-based)
            servicesHTML += `
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-female text-purple-600 mr-2"></i> Women Helpline
                    </h3>
                    <div class="bg-purple-50 rounded-xl p-4 border border-purple-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-gray-800">National Women Helpline</h4>
                                <p class="text-sm text-gray-600 mb-2">24/7 support for women in distress</p>
                            </div>
                            <div>
                                <button onclick="callEmergency('women', '1091')" class="bg-purple-600 hover:bg-purple-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition">
                                    <i class="fas fa-phone-alt mr-1"></i> Call 1091
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            servicesHTML += `
                </div>
            </div>
            `;
            
            emergencyScreen.innerHTML = servicesHTML;
        }

        function showDefaultEmergencyServices() {
            const emergencyScreen = document.getElementById('emergencyScreen');
            
            emergencyScreen.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">Emergency Services</h2>
                        
                        <div class="mb-6 p-4 bg-yellow-50 rounded-lg">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-800">Unable to access your location</p>
                                    <p class="text-sm text-gray-600">Showing general emergency numbers</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- Police -->
                            <div class="emergency-service-card bg-red-50 rounded-xl p-6">
                                <div class="flex items-center mb-4">
                                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-shield-alt text-red-600 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold">Police</h3>
                                        <p class="text-gray-600">Emergency: 100</p>
                                    </div>
                                </div>
                                <button onclick="callEmergency('police')" class="w-full bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition">
                                    <i class="fas fa-phone-alt mr-2"></i> Call Now
                                </button>
                            </div>
                            
                            <!-- Ambulance -->
                            <div class="emergency-service-card bg-blue-50 rounded-xl p-6">
                                <div class="flex items-center mb-4">
                                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-ambulance text-blue-600 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold">Ambulance</h3>
                                        <p class="text-gray-600">Emergency: 102</p>
                                    </div>
                                </div>
                                <button onclick="callEmergency('ambulance')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition">
                                    <i class="fas fa-phone-alt mr-2"></i> Call Now
                                </button>
                            </div>
                            
                            <!-- Fire Department -->
                            <div class="emergency-service-card bg-orange-50 rounded-xl p-6">
                                <div class="flex items-center mb-4">
                                    <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-fire-extinguisher text-orange-600 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold">Fire Department</h3>
                                        <p class="text-gray-600">Emergency: 101</p>
                                    </div>
                                </div>
                                <button onclick="callEmergency('fire')" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-medium py-2 px-4 rounded-lg transition">
                                    <i class="fas fa-phone-alt mr-2"></i> Call Now
                                </button>
                            </div>
                            
                            <!-- Women Helpline -->
                            <div class="emergency-service-card bg-purple-50 rounded-xl p-6">
                                <div class="flex items-center mb-4">
                                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                                        <i class="fas fa-female text-purple-600 text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold">Women Helpline</h3>
                                        <p class="text-gray-600">Emergency: 1091</p>
                                    </div>
                                </div>
                                <button onclick="callEmergency('women')" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition">
                                    <i class="fas fa-phone-alt mr-2"></i> Call Now
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-8 text-center">
                            <button onclick="showNearbyEmergencyServices()" class="inline-flex items-center text-purple-600 hover:text-purple-800 font-medium">
                                <i class="fas fa-location-arrow mr-2"></i> Find Nearby Services
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function getDirections(name, address) {
            // Open a map application like Google Maps
            const encodedAddress = encodeURIComponent(address);
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodedAddress}`, '_blank');
        }

        function callEmergency(service, number = null) {
            const defaultNumbers = {
                police: '100',
                ambulance: '102',
                fire: '101',
                women: '1091',
                hospital: '102'
            };
            
            const serviceNames = {
                police: 'Police',
                ambulance: 'Ambulance',
                fire: 'Fire Department',
                women: 'Women Helpline',
                hospital: 'Hospital'
            };
            
            const phoneNumber = number || defaultNumbers[service];
            
            // Show confirmation dialog
            if (confirm(`Are you sure you want to call ${serviceNames[service]} at ${phoneNumber}?`)) {
                // Initiate a phone call
                window.location.href = `tel:${phoneNumber}`;
                
                // Log event
                console.log(`Calling ${serviceNames[service]} at ${phoneNumber}...`);
            }
        }

        // Contacts Management
        document.getElementById('addContactForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('contactName').value;
            const phone = document.getElementById('contactPhone').value;
            
            addContact(name, phone);
            
            // Reset form
            document.getElementById('addContactForm').reset();
        });

        function addContact(name, phone) {
            const contacts = getContacts();
            const newContact = {
                id: Date.now(),
                name,
                phone
            };
            
            contacts.push(newContact);
            localStorage.setItem('emergencyContacts', JSON.stringify(contacts));
            
            renderContacts();
        }

        function getContacts() {
            const contactsJSON = localStorage.getItem('emergencyContacts');
            return contactsJSON ? JSON.parse(contactsJSON) : [];
        }

        function removeContact(id) {
            const contacts = getContacts();
            const updatedContacts = contacts.filter(contact => contact.id !== id);
            localStorage.setItem('emergencyContacts', JSON.stringify(updatedContacts));
            
            renderContacts();
        }

        function renderContacts() {
            const contacts = getContacts();
            const contactsList = document.getElementById('contactsList');
            
            if (contacts.length === 0) {
                contactsList.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        No contacts added yet. Add emergency contacts above.
                    </div>
                `;
                return;
            }
            
            contactsList.innerHTML = contacts.map(contact => `
                <div class="p-4 flex justify-between items-center hover:bg-gray-50 transition">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full flex items-center justify-center mr-4">
                            <i class="fas fa-user text-purple-600"></i>
                        </div>
                        <div>
                            <div class="font-medium text-gray-800">${contact.name}</div>
                            <div class="text-sm text-gray-600">${contact.phone}</div>
                        </div>
                    </div>
                    <div>
                        <button onclick="removeContact(${contact.id})" class="text-red-500 hover:text-red-700 p-2">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // AI Assistant Functionality
        function setupAiAssistantEventListeners() {
            sendAiMessageBtn.addEventListener('click', sendAiMessage);
            aiInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendAiMessage();
                }
            });
            
            quickActionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const prompt = button.getAttribute('data-prompt');
                    aiInput.value = prompt;
                    sendAiMessage();
                });
            });
        }

        function sendAiMessage() {
            const message = aiInput.value.trim();
            if (!message) return;
            
            // Add user message to chat
            addUserMessage(message);
            
            // Clear input
            aiInput.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate AI response after a delay
            setTimeout(() => {
                removeTypingIndicator();
                const response = generateAiResponse(message);
                addAiResponse(response);
            }, 1500);
        }

        function addUserMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.className = 'ai-message user-message';
            messageElement.innerHTML = `<p>${message}</p>`;
            aiChatContainer.appendChild(messageElement);
            scrollToBottom();
        }

        function addAiResponse(response) {
            const messageElement = document.createElement('div');
            messageElement.className = 'ai-message ai-response';
            messageElement.innerHTML = `<p>${response}</p>`;
            aiChatContainer.appendChild(messageElement);
            scrollToBottom();
        }

        function showTypingIndicator() {
            const typingElement = document.createElement('div');
            typingElement.className = 'typing-indicator';
            typingElement.id = 'typing-indicator';
            typingElement.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            aiChatContainer.appendChild(typingElement);
            scrollToBottom();
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function scrollToBottom() {
            aiChatContainer.scrollTop = aiChatContainer.scrollHeight;
        }

        function generateAiResponse(userMessage) {
            // Simple rule-based responses based on keywords
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('night') || lowerMessage.includes('dark') || lowerMessage.includes('walking alone')) {
                return "For walking alone at night: 1) Stick to well-lit, populated areas, 2) Let someone know your route and expected arrival time, 3) Keep your phone accessible but not visible, 4) Walk confidently and be aware of your surroundings, 5) Consider carrying a personal safety alarm. Would you like more specific advice for your situation?";
            }
            
            if (lowerMessage.includes('taxi') || lowerMessage.includes('ride') || lowerMessage.includes('uber')) {
                return "When using a taxi or ride-share: 1) Verify the driver and license plate before getting in, 2) Sit in the back seat, 3) Share your trip details with a trusted contact, 4) Follow the route on your own GPS, 5) Avoid sharing personal information. If something feels wrong, ask to stop in a safe, public place. Is there anything specific about your ride that concerns you?";
            }
            
            if (lowerMessage.includes('followed') || lowerMessage.includes('following')) {
                return "If you feel you're being followed: 1) Cross the street to see if they follow, 2) Change your pace or direction, 3) Head toward a well-lit, public area with people, 4) Enter a store or business and ask for help, 5) Call emergency services if you feel in immediate danger. Do not lead them to your home. Are you currently in a safe place?";
            }
            
            if (lowerMessage.includes('safety tips') || lowerMessage.includes('general advice')) {
                return "General safety tips: 1) Trust your instincts - if something feels wrong, it probably is, 2) Be aware of your surroundings, 3) Keep emergency contacts easily accessible, 4) Let someone know your plans when going out, 5) Keep your phone charged, 6) Avoid distractions like headphones when walking alone, 7) Have your keys ready before reaching your car or door. Is there a specific situation you'd like advice for?";
            }
            
            if (lowerMessage.includes('harass') || lowerMessage.includes('uncomfortable')) {
                return "If you're experiencing harassment or feel uncomfortable: 1) Trust your instincts and remove yourself from the situation if possible, 2) Make it clear that the behavior is unwelcome, 3) Seek help from others nearby, 4) Move to a safe, public space, 5) Document the incident if it's safe to do so, 6) Report to authorities if necessary. Remember, it's not your fault. Would you like guidance on reporting this incident?";
            }
            
            if (lowerMessage.includes('date') || lowerMessage.includes('meeting someone')) {
                return "For safe dating/meeting new people: 1) Always meet in public places for the first few times, 2) Tell a friend where you're going and who you're meeting, 3) Arrange your own transportation, 4) Keep your phone charged and accessible, 5) Don't share too much personal information too soon, 6) Trust your instincts - if something feels off, leave. Is there a specific aspect of meeting someone you're concerned about?";
            }
            
            if (lowerMessage.includes('home') || lowerMessage.includes('apartment') || lowerMessage.includes('house')) {
                return "Home safety tips: 1) Keep doors and windows locked, even when you're home, 2) Use peepholes or security cameras to see who's at the door, 3) Don't share that you live alone on social media, 4) Have emergency numbers easily accessible, 5) Consider a security system or doorbell camera, 6) Get to know your neighbors. Is there a specific home safety concern you'd like advice on?";
            }
            
            // Default response
            return "I understand you're looking for safety advice. Your safety is important. Could you provide more details about your situation so I can give you more relevant guidance? For example, are you currently in a specific location or facing a particular concern?";
        }

        // Initialize the app
        showScreen('home');
    </script>
</body>
</html>